name: Renovate Config Validation

on:
  workflow_dispatch: {}
  pull_request:
    paths:
      - renovate.json
      - .github/workflows/renovate-validation.yml
  push:
    branches:
      - main
    paths:
      - renovate.json

jobs:
  validate:
    name: Validate Renovate configuration
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js (Node 22.13.x)
        uses: actions/setup-node@v4
        with:
          node-version: '22.13.0'

      - name: Validate Renovate schema (renovate-config-validator)
        run: |
          set -euo pipefail
          npx --yes -p renovate@38 renovate-config-validator --strict renovate.json

      - name: Ensure assignees configurados
        run: |
          node - <<'NODE'
          const fs = require('fs');
          const config = JSON.parse(fs.readFileSync('renovate.json', 'utf8'));
          if (!Array.isArray(config.assignees) || config.assignees.length === 0) {
            throw new Error('renovate.json precisa definir assignees.');
          }
          if (config.assignees.some((assignee) => typeof assignee !== 'string' || !assignee.trim())) {
            throw new Error('Assignees inv√°lidos detectados no renovate.json.');
          }
          NODE
