name: Reminder — OASDIFF pin review (quarterly)

on:
  schedule:
    # 1º dia de Jan/Abr/Jul/Out às 12:00 UTC
    - cron: '0 12 1 1,4,7,10 *'
  workflow_dispatch: {}

jobs:
  open-issue-if-missing:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    steps:
      - name: Ensure quarterly review issue exists
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo } = context.repo;
            const title = 'Trimestral: Revisão do pin do oasdiff (ADR-013)';
            const query = `repo:${owner}/${repo} is:issue is:open in:title "${title}"`;
            const { data } = await github.rest.search.issuesAndPullRequests({ q: query, per_page: 5 });
            if (data.total_count > 0) {
              core.info('Issue de revisão trimestral já aberta.');
              return;
            }
            const body = [
              'Este lembrete automatizado inicia o ciclo trimestral de revisão do pin do oasdiff.',
              '',
              'Referências:',
              '- ADR-013: docs/adr/013-governanca-pin-oasdiff.md',
              '- Runbook: docs/runbooks/governanca-oasdiff-pin.md',
              '',
              'Checklist (copie para o PR):',
              '- [ ] Analisar changelog upstream',
              '- [ ] Abrir PR de teste com novo pin (não usar latest)',
              '- [ ] Rodar oasdiff breaking e publicar changelog',
              '- [ ] Ajustar cache keys/paths se necessário',
              '- [ ] Plano de rollback documentado',
              '',
              'Observação: inclua uma tag @SC-00x no título ou corpo do PR conforme política.'
            ].join('\n');
            await github.rest.issues.create({ owner, repo, title, body });

